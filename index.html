<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­«å­å…µæ³•ï¼šå¤§å°‡è»ä¹‹è·¯ (v6.5 å­¸ç¿’åŠ å¼·ç‰ˆ)</title>
    <style>
        :root {
            /* è»ç‡Ÿæ²ˆæµ¸é…è‰² */
            --bg-canvas: #e0d6c4;
            --wood-frame: #4e342e;
            --wood-light: #8d6e63;
            --rank-gold: #ffb300;
            --army-red: #b71c1c;
            --hint-glow: #ffeb3b; /* æç¤ºå…‰æšˆ */
        }

        body {
            font-family: "Kaiti TC", "æ¥·é«”", "STKaiti", serif;
            margin: 0;
            padding: 0;
            background-color: #5d4037;
            background-image: repeating-linear-gradient(45deg, #4e342e 0, #4e342e 10px, #3e2723 10px, #3e2723 20px);
            color: var(--wood-frame);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* === é ‚éƒ¨è»æƒ…æ¢ (ä¿ç•™å¦³å–œæ­¡çš„è¨­è¨ˆ) === */
        header {
            width: 100%;
            background: var(--wood-frame);
            color: #d7ccc8;
            padding: 8px 15px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #8d6e63;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .rank-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--rank-gold);
        }
        
        .rank-icon {
            width: 30px;
            height: 30px;
            background: var(--army-red);
            border-radius: 5px;
            border: 2px solid var(--rank-gold);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
        }

        /* åŠŸèƒ½æŒ‰éˆ•å€ (éœéŸ³/æç¤º) */
        .settings-area {
            display: flex;
            gap: 15px;
        }
        .icon-btn {
            background: none;
            border: 1px solid #8d6e63;
            border-radius: 50%;
            color: #d7ccc8;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.2s;
        }
        .icon-btn.active {
            background: var(--rank-gold);
            color: var(--wood-frame);
            border-color: var(--rank-gold);
            box-shadow: 0 0 10px var(--rank-gold);
        }

        /* === ä¸»æˆ°å ´ === */
        #battlefield {
            flex: 1;
            width: 100%;
            max-width: 600px;
            background: var(--bg-canvas);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            padding: 15px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        /* NPC å€ */
        .npc-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-start;
            z-index: 10;
        }

        .npc-portrait {
            width: 60px;
            height: 60px;
            background: var(--wood-frame);
            border: 3px solid #8d6e63;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            flex-shrink: 0;
        }

        .npc-dialogue {
            background: #fff;
            padding: 12px 18px;
            border-radius: 4px 15px 15px 15px;
            border: 2px solid var(--wood-frame);
            font-size: 1rem;
            line-height: 1.5;
            position: relative;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }
        .npc-dialogue::before {
            content: ''; position: absolute; top: 15px; left: -10px;
            border-width: 6px 10px 6px 0; border-style: solid;
            border-color: transparent var(--wood-frame) transparent transparent;
        }

        /* ç›®æ¨™å€ (å·è»¸) */
        .scroll-area {
            flex: 1;
            background: rgba(255, 255, 255, 0.5);
            border: 2px dashed var(--wood-light);
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            z-index: 10;
        }

        /* å€™é¸å€ */
        .deck-area {
            min-height: 120px;
            background: rgba(62, 39, 35, 0.1);
            border-top: 3px solid var(--wood-frame);
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            z-index: 10;
        }

        /* ç«¹ç°¡æ¨£å¼ */
        .bamboo-tile {
            background: linear-gradient(to bottom, #ffecb3, #ffca28);
            border: 1px solid #8d6e63;
            border-top: 3px solid #6d4c41;
            border-bottom: 3px solid #6d4c41;
            padding: 10px 18px;
            border-radius: 3px;
            font-size: 1.25rem;
            color: #3e2723;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s;
            user-select: none;
            position: relative;
        }
        .bamboo-tile:active { transform: scale(0.95); }

        /* ğŸŒŸ æç¤ºç‰¹æ•ˆ (å‘¼å¸ç‡ˆ) */
        .bamboo-tile.hint-active {
            animation: hintPulse 1.2s infinite alternate;
            border-color: #ff6f00;
            box-shadow: 0 0 15px var(--hint-glow);
            z-index: 20;
        }
        @keyframes hintPulse {
            0% { transform: scale(1); filter: brightness(1); }
            100% { transform: scale(1.05); filter: brightness(1.2); }
        }

        /* è¦–çª—é€šç”¨ (æ™‰å‡ & ç¿»è­¯) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none; justify-content: center; align-items: center; z-index: 2000;
        }
        .paper-scroll {
            background: #fff8e1;
            width: 85%; max-width: 450px;
            padding: 25px;
            text-align: center;
            border-top: 15px solid var(--wood-frame);
            border-bottom: 15px solid var(--wood-frame);
            box-shadow: 0 0 30px #000;
            position: relative;
        }

        /* ç¿»è­¯æ–‡å­— */
        .translation-box {
            background: #efebe9;
            padding: 15px;
            border-radius: 5px;
            text-align: left;
            margin: 15px 0;
            line-height: 1.6;
            color: #3e2723;
            font-size: 1rem;
        }
        
        .army-btn {
            background: var(--wood-frame);
            color: #fff;
            border: none;
            padding: 10px 25px;
            font-size: 1.1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .army-btn.primary { background: var(--army-red); }

    </style>
</head>
<body>

<header>
    <div class="rank-badge">
        <div class="rank-icon" id="rank-icon">å’</div>
        <span id="rank-name">æ­¥å’</span>
        <span style="font-size:0.8rem; margin-left:5px; color:#bcaaa4;" id="level-display">(1/33)</span>
    </div>
    
    <div class="settings-area">
        <button class="icon-btn active" id="hint-btn" onclick="toggleHint()">ğŸ’¡</button>
        <button class="icon-btn" id="mute-btn" onclick="toggleMute()">ğŸ”Š</button>
    </div>
</header>

<div id="battlefield">
    <div style="position:absolute; top:5px; right:10px; font-size:0.8rem; color:rgba(62,39,35,0.4); font-weight:bold;" id="chapter-name">ç¬¬ä¸€ç¯‡ï¼šå§‹è¨ˆ</div>
    
    <div class="npc-container">
        <div class="npc-portrait">å­«</div>
        <div class="npc-dialogue" id="npc-text">æ–°å…µï¼ä¾ç«¹ç°¡å…‰èŠ’ï¼Œä½ˆä¸‹é™£å‹¢ï¼</div>
    </div>

    <div class="scroll-area" id="target-zone">
        <div style="color:#8d6e63; margin-top:30px;">(é»æ“Šä¸‹æ–¹ç«¹ç°¡)</div>
    </div>

    <div class="deck-area" id="source-zone">
        </div>
</div>

<div class="modal" id="win-modal">
    <div class="paper-scroll">
        <h2 style="color:var(--army-red); margin:0;">â˜… è»ä»¤é”æˆ â˜…</h2>
        <div style="font-size:1.2rem; font-weight:bold; margin:15px 0;" id="win-original-text"></div>
        <div class="translation-box">
            <strong>ã€ç™½è©±é‡‹ç¾©ã€‘</strong><br>
            <span id="win-translation-text"></span>
        </div>
        <button class="army-btn primary" onclick="nextLevel()">é ˜å‘½ (ä¸‹ä¸€é—œ)</button>
    </div>
</div>

<div class="modal" id="rank-modal">
    <div class="paper-scroll">
        <div style="position:absolute; top:10px; right:20px; border:3px solid var(--army-red); color:var(--army-red); padding:5px; transform:rotate(15deg); font-weight:bold;">æ™‰å‡ä»¤</div>
        <h2 style="color:var(--army-red); font-size:1.8rem;">å®˜éšæ™‰å‡</h2>
        <p>æˆ°åŠŸå½ªç‚³ï¼Œç‰¹æ­¤æ‹”æ“¢ç‚º</p>
        <h1 id="new-rank-title" style="font-size:2.5rem; margin:10px 0; color:var(--wood-frame)">ä¼é•·</h1>
        <button class="army-btn" onclick="closeRankModal()">è¬ä¸»éš†æ©</button>
    </div>
</div>

<script>
    // === 1. é¡Œåº«èˆ‡ç¿»è­¯è³‡æ–™ (ç¯„ä¾‹) ===
    const levelsData = [
        { text: "å…µè€…ï¼Œåœ‹ä¹‹å¤§äº‹", translation: "æˆ°çˆ­æ˜¯åœ‹å®¶çš„å¤§äº‹ã€‚" },
        { text: "æ­»ç”Ÿä¹‹åœ°ï¼Œå­˜äº¡ä¹‹é“ï¼Œä¸å¯ä¸å¯Ÿä¹Ÿ", translation: "é—œä¿‚åˆ°è»æ°‘çš„ç”Ÿæ­»ï¼Œåœ‹å®¶çš„å­˜äº¡ï¼Œæ˜¯çµ•å°ä¸å¯ä»¥ä¸èªçœŸè€ƒå¯Ÿç ”ç©¶çš„ã€‚" },
        { text: "æ•…ç¶“ä¹‹ä»¥äº”äº‹ï¼Œæ ¡ä¹‹ä»¥è¨ˆï¼Œè€Œç´¢å…¶æƒ…", translation: "æ‰€ä»¥è¦å¾äº”å€‹æ–¹é¢ä¾†åˆ†æç ”ç©¶ï¼Œç”¨é€™äº”æ–¹é¢çš„å…§å®¹é€²è¡Œæ¯”è¼ƒï¼Œå¾è€Œæ¢æ±‚æˆ°çˆ­å‹è² çš„æƒ…å‹¢ã€‚" },
        { text: "ä¸€æ›°é“ï¼ŒäºŒæ›°å¤©ï¼Œä¸‰æ›°åœ°ï¼Œå››æ›°å°‡ï¼Œäº”æ›°æ³•", translation: "ç¬¬ä¸€æ˜¯é“ï¼ˆæ”¿æ²»ï¼‰ï¼Œç¬¬äºŒæ˜¯å¤©ï¼ˆå¤©æ™‚ï¼‰ï¼Œç¬¬ä¸‰æ˜¯åœ°ï¼ˆåœ°åˆ©ï¼‰ï¼Œç¬¬å››æ˜¯å°‡ï¼ˆå°‡é ˜ï¼‰ï¼Œç¬¬äº”æ˜¯æ³•ï¼ˆæ³•åˆ¶ï¼‰ã€‚" },
        { text: "é“è€…ï¼Œä»¤æ°‘èˆ‡ä¸ŠåŒæ„ä¹Ÿ", translation: "æ‰€è¬‚ã€Œé“ã€ï¼Œå°±æ˜¯ä½¿æ°‘çœ¾èˆ‡å›ä¸»çš„æ„é¡˜ä¸€è‡´ã€‚" },
        { text: "æ•…å¯èˆ‡ä¹‹æ­»ï¼Œå¯èˆ‡ä¹‹ç”Ÿï¼Œè€Œä¸ç•å±", translation: "é€™æ¨£ï¼Œæ°‘çœ¾å°±èƒ½èˆ‡å›ä¸»åŒç”Ÿæ­»ã€å…±æ‚£é›£ï¼Œè€Œä¸ç•æ‡¼å±éšªã€‚" },
        { text: "å¤©è€…ï¼Œé™°é™½ã€å¯’æš‘ã€æ™‚åˆ¶ä¹Ÿ", translation: "æ‰€è¬‚ã€Œå¤©ã€ï¼Œå°±æ˜¯æŒ‡æ™å¤œé™°é™½çš„è®ŠåŒ–ï¼Œå¯’å†¬æš‘å­£çš„æ›´æ›¿ï¼Œä»¥åŠé©æ–¼ä½œæˆ°çš„å­£ç¯€æ°£å€™ã€‚" },
        { text: "åœ°è€…ï¼Œé è¿‘ã€éšªæ˜“ã€å»£ç‹¹ã€æ­»ç”Ÿä¹Ÿ", translation: "æ‰€è¬‚ã€Œåœ°ã€ï¼Œæ˜¯æŒ‡è·¯ç¨‹çš„é è¿‘ã€åœ°å‹¢çš„éšªè¦æˆ–å¹³å¦ã€æˆ°å ´çš„å»£é—Šæˆ–ç‹¹çª„ï¼Œä»¥åŠåœ°å½¢æ˜¯çµ•åœ°é‚„æ˜¯ç”Ÿè·¯ã€‚" },
        { text: "å°‡è€…ï¼Œæ™ºã€ä¿¡ã€ä»ã€å‹‡ã€åš´ä¹Ÿ", translation: "æ‰€è¬‚ã€Œå°‡ã€ï¼Œå°±æ˜¯å°‡é ˜è¦å…·å‚™æ™ºæ…§ã€èª ä¿¡ã€ä»æ„›ã€å‹‡æ•¢ã€åš´æ˜é€™äº”ç¨®ç´ è³ªã€‚" },
        { text: "æ³•è€…ï¼Œæ›²åˆ¶ã€å®˜é“ã€ä¸»ç”¨ä¹Ÿ", translation: "æ‰€è¬‚ã€Œæ³•ã€ï¼Œæ˜¯æŒ‡è»éšŠçš„çµ„ç¹”ç·¨åˆ¶ã€å°‡åçš„è·è²¬ç®¡ç†ã€ä»¥åŠè»éœ€ç‰©è³‡çš„ä¾›æ‡‰ç®¡ç†ã€‚" }
    ];

    // === 2. ç³»çµ±è®Šæ•¸ ===
    let currentLevel = 0;
    let currentSelection = [];
    let currentPool = [];
    let isHintOn = true;
    let isMuted = false;

    const ranks = [
        { title: "æ­¥å’", icon: "å’", min: 0 },
        { title: "ä¼é•·", icon: "ä¼", min: 5 },
        { title: "ç™¾å¤«é•·", icon: "ç™¾", min: 10 },
        { title: "åƒå¤«é•·", icon: "åƒ", min: 20 },
        { title: "å°‡è»", icon: "å°‡", min: 30 }
    ];

    // === 3. åˆå§‹åŒ– ===
    window.onload = function() {
        if(localStorage.getItem('sunTzuProgress')) {
            currentLevel = parseInt(localStorage.getItem('sunTzuProgress'));
            if(currentLevel >= levelsData.length) currentLevel = 0;
        }
        loadLevel(currentLevel);
        updateRankDisplay();
    };

    function loadLevel(idx) {
        // ä¿è­·æ©Ÿåˆ¶ï¼šå¦‚æœè¶…éé¡Œåº«ï¼Œæš«æ™‚å›åˆ°ç¬¬ä¸€é¡Œ
        if (idx >= levelsData.length) { idx = 0; currentLevel = 0; }
        
        const data = levelsData[idx];
        document.getElementById('level-display').innerText = `(${idx + 1}/${levelsData.length})`;
        
        // NPC å°è©±
        const npcText = document.getElementById('npc-text');
        npcText.innerText = isHintOn ? "ä¾é–ƒçˆç«¹ç°¡ï¼Œæ’åˆ—é™£å‹¢ï¼" : "å°‡è»ï¼Œè«‹æ†‘è¨˜æ†¶ä½ˆé™£ï¼";
        npcText.style.color = "#000";

        // æº–å‚™ç«¹ç°¡ (åˆ†è©)
        currentSelection = [];
        let segments = splitSentence(data.text);
        currentPool = [...segments].sort(() => Math.random() - 0.5); // æ‰“äº‚

        renderBoard();
        document.getElementById('win-modal').style.display = 'none';
        document.getElementById('target-zone').className = 'scroll-area';
    }

    function splitSentence(str) {
        // ç°¡å–®ä¾æ¨™é»ç¬¦è™Ÿåˆ‡åˆ†ï¼Œä¿ç•™æ¨™é»
        let parts = str.split(/(?=[ï¼Œã€ã€‚ï¼›])/); 
        // è™•ç†ä¸€ä¸‹ï¼Œè®“æ¨™é»è·Ÿè‘—ä¸Šä¸€å¥æˆ–ç¨ç«‹? 
        // é€™è£¡æ”¹ç”¨ç°¡å–®é‚è¼¯ï¼šå¦‚æœæœ‰é€—è™Ÿï¼Œå°±ä¾é€—è™Ÿåˆ‡
        let res = [];
        let temp = str.split(/[ï¼Œã€ã€‚ï¼›]/).filter(s => s.trim() !== "");
        // é€™è£¡ç‚ºäº†éŠæˆ²æ€§ï¼Œæˆ‘å€‘ç°¡å–®æŠŠå­—ä¸²æ‹†æˆå¹¾å€‹éƒ¨åˆ†
        if (str.length <= 4) return [str];
        // æ¨¡æ“¬åˆ‡åˆ†ï¼šå°åŠåˆ‡
        let mid = Math.floor(str.length / 2);
        // å¦‚æœæœ‰æ¨™é»ï¼Œå„ªå…ˆç”¨æ¨™é»åˆ‡
        if (str.includes('ï¼Œ')) return str.split('ï¼Œ').map((s, i, arr) => i < arr.length -1 ? s + 'ï¼Œ' : s);
        return [str.substring(0, mid), str.substring(mid)];
    }

    function renderBoard() {
        const targetZone = document.getElementById('target-zone');
        const sourceZone = document.getElementById('source-zone');
        
        targetZone.innerHTML = '';
        sourceZone.innerHTML = '';

        // å·²é¸å€
        if (currentSelection.length === 0) {
            targetZone.innerHTML = '<div style="color:#8d6e63; margin-top:30px; opacity:0.6;">(é»æ“Šä¸‹æ–¹ç«¹ç°¡)</div>';
        } else {
            currentSelection.forEach((text) => {
                targetZone.appendChild(createTile(text, 'target'));
            });
        }

        // å€™é¸å€
        currentPool.forEach((text) => {
            sourceZone.appendChild(createTile(text, 'source'));
        });

        if (isHintOn) applyHintEffect();
    }

    function createTile(text, type) {
        const div = document.createElement('div');
        div.className = 'bamboo-tile';
        div.innerText = text;
        div.setAttribute('data-text', text); // ç”¨æ–¼æç¤ºæ¯”å°
        div.onclick = () => moveTile(text, type);
        return div;
    }

    function moveTile(text, type) {
        playClickSound();
        if (type === 'source') {
            currentPool = currentPool.filter(t => t !== text);
            currentSelection.push(text);
        } else {
            currentSelection = currentSelection.filter(t => t !== text);
            currentPool.push(text);
        }
        renderBoard();
        checkAnswer();
    }

    // ğŸŒŸ æç¤ºç³»çµ±é‚è¼¯
    function applyHintEffect() {
        const data = levelsData[currentLevel];
        // å–å¾—æ­£ç¢ºé †åºçš„ segments (é€™è£¡æˆ‘å€‘é‡æ–°åˆ‡åˆ†ä¸€æ¬¡ä¾†æ¯”å°)
        let correctSegments = splitSentence(data.text);
        
        // æ‰¾å‡ºä¸‹ä¸€å€‹æ‡‰è©²é¸ä»€éº¼
        let nextIndex = currentSelection.length;
        if (nextIndex >= correctSegments.length) return;
        
        let nextText = correctSegments[nextIndex];

        // åœ¨ sourceZone è£¡æ‰¾åˆ°å°æ‡‰çš„æŒ‰éˆ•åŠ  class
        const buttons = document.getElementById('source-zone').children;
        for (let btn of buttons) {
            if (btn.getAttribute('data-text') === nextText) {
                btn.classList.add('hint-active');
                break; // åªæç¤ºä¸€å€‹
            }
        }
    }

    function toggleHint() {
        isHintOn = !isHintOn;
        document.getElementById('hint-btn').className = isHintOn ? 'icon-btn active' : 'icon-btn';
        document.getElementById('hint-btn').innerText = isHintOn ? 'ğŸ’¡' : 'ğŸŒ‘';
        renderBoard(); // é‡æ–°æ¸²æŸ“ä»¥å¥—ç”¨/ç§»é™¤ç‰¹æ•ˆ
    }

    function toggleMute() {
        isMuted = !isMuted;
        document.getElementById('mute-btn').innerText = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        document.getElementById('mute-btn').className = isMuted ? 'icon-btn active' : 'icon-btn';
    }

    function checkAnswer() {
        const data = levelsData[currentLevel];
        // ç°¡å–®æ¯”å°ï¼šä½¿ç”¨è€…çµ„å‡ºä¾†çš„å¥å­ = åŸå¥
        if (currentSelection.join('') === data.text) {
            playWinSound();
            showWinModal(data);
        }
    }

    function showWinModal(data) {
        document.getElementById('win-original-text').innerText = data.text;
        document.getElementById('win-translation-text').innerText = data.translation;
        document.getElementById('win-modal').style.display = 'flex';
    }

    function nextLevel() {
        document.getElementById('win-modal').style.display = 'none';
        currentLevel++;
        localStorage.setItem('sunTzuProgress', currentLevel);
        
        checkRankUp();
        loadLevel(currentLevel);
    }

    // === å®˜éšèˆ‡éŸ³æ•ˆ ===
    function checkRankUp() {
        let newRank = ranks[0];
        for (let r of ranks) { if (currentLevel >= r.min) newRank = r; }
        
        let currentTitle = document.getElementById('rank-name').innerText;
        if (newRank.title !== currentTitle) {
            document.getElementById('new-rank-title').innerText = newRank.title;
            document.getElementById('rank-modal').style.display = 'flex';
            playWinSound();
        }
        updateRankDisplay();
    }

    function updateRankDisplay() {
        let r = ranks[0];
        for (let item of ranks) { if (currentLevel >= item.min) r = item; }
        document.getElementById('rank-icon').innerText = r.icon;
        document.getElementById('rank-name').innerText = r.title;
    }

    function closeRankModal() {
        document.getElementById('rank-modal').style.display = 'none';
    }

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playClickSound() {
        if (isMuted) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(300, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }
    function playWinSound() {
        if (isMuted) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const now = audioCtx.currentTime;
        [440, 554, 659].forEach((f, i) => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.value = f;
            gain.gain.setValueAtTime(0.1, now + i*0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, now + i*0.1 + 0.4);
            osc.start(now + i*0.1); osc.stop(now + i*0.1 + 0.4);
        });
    }

</script>
</body>
</html>
